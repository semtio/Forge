# Class-Based Link Encryption

## Описание

Система автоматического добавления зашифрованных ссылок к кнопкам по имени класса. Позволяет редакторам контента просто добавлять класс к кнопке в HTML, не заботясь об URL - ссылка подставится автоматически из конфигурации при сборке проекта.

## Как это работает

### 1. Настройка ссылок в конфигурации

В файле `generator/config.php` добавьте ссылки с префиксом `btn_link`:

```php
'data' => [
    'btn_link1' => 'https://google.com',
    'btn_link2' => 'https://partner-site.com/promo',
    'btn_link3' => 'https://yahoo.com',
    // Можете добавить btn_link4, btn_link5 и т.д.
]
```

### 2. Использование в HTML (TinyMCE)

В файлах `plugins/tinymce/data/content-*.html` просто добавьте класс к кнопке:

```html
<!-- Простая кнопка без href -->
<a class="btn-link1">Нажми меня</a>

<!-- Кнопка со стилями и несколькими классами -->
<a class="my-button btn-link2" style="background: blue; color: white;">
  Перейти на сайт
</a>

<!-- Кнопка с существующим href будет перезаписана -->
<a class="btn-link3" href="old-link.html">Обновится</a>
```

### 3. Автоматическая обработка

При запуске `php cli.php`:

1. Система создаёт зашифрованные ключи для всех `btn_link*` из конфига
2. Сканирует HTML файлы в `plugins/tinymce/data/`
3. Находит все `<a>` теги с классами `btn-link1`, `btn-link2`, `btn-link3` и т.д.
4. Добавляет или заменяет атрибут `href` зашифрованной ссылкой
5. Копирует обработанные файлы в `build/`

### Результат

```html
<!-- Исходный HTML -->
<a class="btn-link1">Нажми меня</a>

<!-- После генерации -->
<a class="btn-link1" href="./encrypted.php?key=05046f26c83e8c88">Нажми меня</a>
```

При клике пользователь перейдёт на Google через зашифрованный редирект.

## Преимущества

✅ **Простота редактирования**: Редактор просто добавляет класс, не копируя длинные URL
✅ **Безопасность**: Реальные партнёрские ссылки скрыты за зашифрованными ключами
✅ **Централизованное управление**: Все ссылки в одном месте - `config.php`
✅ **Совместимость с TinyMCE**: Работает в визуальном редакторе без PHP кода
✅ **Гибкость**: Поддерживает неограниченное количество кнопок (btn-link1...N)

## Технические детали

### Формат класса

- Класс должен начинаться с `btn-link` и заканчиваться цифрой: `btn-link1`, `btn-link2`, `btn-link3` и т.д.
- Можно комбинировать с другими классами: `class="my-button btn-link1 active"`
- Регистронезависимое сопоставление

### Приоритет

Если кнопка уже имеет атрибут `href`, он будет **заменён** на зашифрованную ссылку.

### Область действия

Обрабатываются файлы:
- `plugins/tinymce/data/*.html` (после копирования в build)
- Все HTML/PHP файлы в директории проекта (через `processButtonLinksByClass`)

### Процесс шифрования

1. URL из конфига хешируется с использованием SHA-256
2. Берутся первые 16 символов хеша в качестве ключа
3. Создаётся файл `encrypted.php` с маппингом ключ → URL
4. Ссылка формируется как `./encrypted.php?key=<хеш>`

## Примеры использования

### Множество кнопок с одной ссылкой

```html
<a class="header-btn btn-link1">Регистрация</a>
<a class="hero-btn btn-link1">Начать играть</a>
<a class="footer-btn btn-link1">Присоединиться</a>
```

Все три кнопки получат одинаковую зашифрованную ссылку на Google.

### Разные ссылки для разных секций

```html
<!-- Основная партнёрка -->
<a class="btn-link1">Главный бонус</a>

<!-- Альтернативная партнёрка -->
<a class="btn-link2">Второй вариант</a>

<!-- Резервная ссылка -->
<a class="btn-link3">Запасной вариант</a>
```

### Сложные стили

```html
<a class="btn btn-primary btn-link1"
   style="background: linear-gradient(45deg, #F03D55, #FF6B6B); padding: 15px 30px;">
  Получить бонус 500$
</a>
```

## Отладка

Для проверки работы:

1. Откройте `build/ваш-домен.com/encrypted.php`
2. Найдите маппинг ключей → URL
3. Проверьте, что ключи в HTML соответствуют ключам в файле

Пример `encrypted.php`:
```php
$links = [
    '05046f26c83e8c88' => 'https://google.com',    // btn_link1
    'cf0d7b5c6127539a' => 'https://yahoo.com',     // btn_link3
];
```

## Ограничения

⚠️ Класс должен содержать ТОЛЬКО `btn-link` + цифру (например, `btn-link1`)
⚠️ Нельзя использовать `btn-link` без цифры
⚠️ Если в конфиге нет соответствующего `btn_link*`, кнопка не будет обработана

## Связанные файлы

- `generator/generate.php` - функции `injectEncryptedLinksToClasses()` и `processButtonLinksByClass()`
- `generator/config.php` - определение ссылок btn_link*
- `build/*/encrypted.php` - сгенерированный файл редиректов
- `plugins/tinymce/data/*.html` - контент для редактирования
